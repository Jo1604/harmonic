<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Indie Flower">
    <style>
      body {
        font-family: "Indie Flower";
        font-size: 32px;
        color: white
      }
    </style>
  </head>
  <style>
    body {
      background-color: #40474b;
    }
    p {
      text-align: center;
    }
  </style>
  <body>
    <p>Follow the Paths and find trees that trasport you to differnt worlds. Don't forget to explore</p>

    <script src="three.min.js"></script>
    <script src="three.module.js" type="module"></script>
    <script src="GLTFLoader.js" type="module"></script>
    <canvas id="canvas1"></canvas>
    <script type="module">
      //import { WebGLRenderer, PerspectiveCamera, Vector3 } from 'three';
      import * as THREE from 'https://threejsfundamentals.org/threejs/resources/threejs/r122/build/three.module.js';
      import {GLTFLoader} from 'https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/loaders/GLTFLoader.js';
      import {PointerLockControls} from 'https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/controls/PointerLockControls.js';

      // Initialize core ThreeJS components
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera();
        console.log(scene);

        // Set up camera
        camera.position.set(4, 1, 3);
        //camera.lookAt(new THREE.Vector3(3, 0, 5));

        // Set up renderer, canvas, and minor CSS adjustments
        const canvas = document.getElementById('canvas1');
        const renderer = new THREE.WebGLRenderer({ canvas });
        renderer.setSize(window.innerWidth, window.innerHeight);

        // Set up controls
        const controls = new PointerLockControls(camera, canvas);
        controls.addEventListener('locked', function () {

        });
        var onKeyDown = function (event) {
            switch (event.keyCode) {
                case 38: // up
                case 87: // w
                    moveForward = true;
                    break;

                case 37: // left
                case 65: // a
                    moveLeft = true;
                    break;

                case 40: // down
                case 83: // s
                    moveBackward = true;
                    break;

                case 39: // right
                case 68: // d
                    moveRight = true;
                    break;
            }
        };
        var onKeyUp = function (event) {
            switch (event.keyCode) {
                case 38: // up
                case 87: // w
                    moveForward = false;
                    break;

                case 37: // left
                case 65: // a
                    moveLeft = false;
                    break;

                case 40: // down
                case 83: // s
                    moveBackward = false;
                    break;

                case 39: // right
                case 68: // d
                    moveRight = false;
                    break;
            }
        };
        window.addEventListener('keydown', onKeyDown, false);
        window.addEventListener('keyup', onKeyUp, false);

        // Set up controls
        //const controls = new OrbitControls(camera, canvas);
        //controls.enableDamping = true;
        //controls.enablePan = false;
        //controls.minDistance = 4;
        //controls.maxDistance = 16;
        //controls.update();

        //lighting
        const dir = new THREE.SpotLight(0xffffff, 1.6, 7, 0.8, 1, 1);
        const ambi = new THREE.AmbientLight(0x404040, 1.32);
        const hemi = new THREE.HemisphereLight(0xffffbb, 0x080820, 2.3);

        dir.position.set(5, 1, 2);
        dir.target.position.set(0, 0, 0);
        scene.add(dir);
        scene.add(ambi);
        scene.add(hemi);

        // sunset stars
        var starGeo = new THREE.Geometry();
        for (let i = 0; i < 6000; i++) {
            let star =new THREE.Vector3(
                Math.random() * 600 - 300,
                Math.random() * 600 - 300,
                Math.random() * 600 - 300
            );
            starGeo.vertices.push(star);
        }
        let starMaterial = new THREE.PointsMaterial({
            color: 0xFFFFFF,
            size: 0.7
        });

        var stars = new THREE.Points(starGeo, starMaterial);
        // Set background to a nice color
        scene.background = new THREE.Color(0xffcaa7);
        scene.add(stars);

        //loaders
        const loader = new GLTFLoader();
        loader.load('./MainSceneBin.glb', function (gltf) {
          scene.add( gltf.scene );
        });

        // Render loop
        const onAnimationFrameHandler = (timeStamp) => {
            //controls.update();
            renderer.render(scene, camera);
            scene.update && scene.update(timeStamp);
            window.requestAnimationFrame(onAnimationFrameHandler);
        };
        window.requestAnimationFrame(onAnimationFrameHandler);

        // Resize Handler
        const windowResizeHandler = () => {
            const { innerHeight, innerWidth } = window;
            renderer.setSize(innerWidth/1.03, innerHeight);
            camera.aspect = innerWidth / innerHeight;
            camera.updateProjectionMatrix();
        };
        windowResizeHandler();
        window.addEventListener('resize', windowResizeHandler, false);
    </script>
  </body>
</html>
